"use strict";(self["webpackChunkmy_trello_frontend"]=self["webpackChunkmy_trello_frontend"]||[]).push([[916],{916:function(t,i,e){e.r(i),e.d(i,{default:function(){return D}});var n=function(){var t=this,i=t._self._c;t._self._setupProxy;return i("div",{staticClass:"board__container"},[i("LabelEditable",{attrs:{name:"title",id:t.labelId,api:`board/${t.$route.params.board_id}`,minLength:t.formSchema.fields[0]?.minLength??t.$store.state.defaultMinLength,"custom-class":"label__editable"},model:{value:t.boardTitle,callback:function(i){t.boardTitle=i},expression:"boardTitle"}}),i("div",{staticClass:"board__item"},[t._l(t.board&&t.board.lists?t.board.lists:[],(function(t){return i("ListComponent",{key:t.id,attrs:{title:t.title,cards:t.cards,id:t.id}})})),i("button",{staticClass:"button__add",on:{click:function(i){t.showModal=!0}}},[i("span",{staticClass:"material-symbols-outlined"},[t._v(" add_circle ")])]),t.showModal?i("Modal",{attrs:{formSchema:t.formSchema},on:{close:function(i){t.showModal=!1}}}):t._e()],2)],1)},r=[],a=e(635),o=e(471),s=e(647),d=function(){var t=this,i=t._self._c;t._self._setupProxy;return i("div",[t.isEditing?t._e():i("div",{class:[t.customClass,{editing:t.isEditing,"not-editing":!t.isEditing},"break-word"],on:{click:t.startEditing,keydown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.startEditing.apply(null,arguments)}}},[t._v(" "+t._s(t.inputValue)+" ")]),i("label",{attrs:{for:t.id}},[i("input",{directives:[{name:"show",rawName:"v-show",value:t.isEditing,expression:"isEditing"}],ref:"editableInput",class:[t.customClass,{editing:t.isEditing,"not-editing":!t.isEditing}],attrs:{id:t.id,api:t.api,name:t.name,minlength:t.minLength,type:"text"},domProps:{value:t.inputValue},on:{focus:t.onFocus,blur:t.onBlur,keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.onEnter.apply(null,arguments)},input:t.onInput}})])])},l=[],u=e(549),c=o.Ay.extend({name:"EditableInput",props:{value:{type:String,required:!0},name:{type:String,required:!0},id:{type:[String,Number],required:!0},api:{type:String,required:!0},minLength:{type:Number,required:!0},customClass:{type:String,required:!1}},data:function(){return{isEditing:!1,inputValue:this.value,notyf:new u.zT({duration:4e3,position:{x:"right",y:"top"}})}},methods:{onBlur:function(t){this.offFocus(t)},onEnter:function(t){var i=t.target;i.blur()},onFocus:function(){this.isEditing=!0},offFocus:function(t){var i=t.target;this.isEditing&&this.inputValue.length>=this.minLength?(i.style.borderColor="transparent",this.isEditing=!1,this.updateTitle()):(i.style.borderColor="red",this.notyf.error("Minimal length for this input is ".concat(this.minLength," symbol(s)")))},updateTitle:function(){this.$store.dispatch("updateTitle",{apiPath:this.api,fieldName:this.name,newValue:this.inputValue}),this.$emit("update",this.inputValue),this.$refs.editableInput.blur()},onInput:function(t){this.inputValue=t.target.value},startEditing:function(){var t=this;this.isEditing=!0,this.$nextTick((function(){t.$refs.editableInput.focus()}))}},watch:{value:function(t){this.inputValue=t}}}),m=c,p=e(656),h=(0,p.A)(m,d,l,!1,null,null,null),f=h.exports,g=function(){var t=this,i=t._self._c;t._self._setupProxy;return i("div",[i("div",{staticClass:"card__item-title"},[i("LabelEditable",{attrs:{name:"title",id:t.id,api:`board/${t.$route.params.board_id}/list/${t.id}`,minLength:t.formSchema.fields[0]?.minLength??t.$store.state.defaultMinLength,"custom-class":"cart__item-label"},model:{value:t.listTitle,callback:function(i){t.listTitle=i},expression:"listTitle"}})],1),i("div",{staticClass:"card__item",attrs:{id:"container-"+t.id},on:{dragenter:function(i){return i.preventDefault(),t.onDragEnter.apply(null,arguments)}}},[t._l(t.cards,(function(e){return i("button",{key:e.id,staticClass:"card__item-row break-word",style:{backgroundColor:e.color},attrs:{id:`card-${e.id}`,draggable:"true"},on:{click:function(i){return t.editCard(e.id)},dragstart:function(i){return t.onDragStart(i,e.id)},dragover:function(i){return t.onDragOver(i)},dragend:function(i){return i.preventDefault(),t.onDragEnd.apply(null,arguments)}}},[t._v(" "+t._s(e.title)+" "),i("button",{staticClass:"button_rmv material-symbols-outlined",on:{click:function(i){return i.stopPropagation(),t.removeCard(e.id)}}},[t._v("delete ")])])})),t.showModal?i("Modal",{attrs:{formSchema:t.formSchema},on:{close:function(i){t.showModal=!1}}}):t._e(),t.cardModal?i("Modal",{attrs:{formSchema:t.formCardSchema},on:{close:t.handleModalClose}}):t._e()],2),i("div",{staticClass:"card__item-footer"},[i("button",{staticClass:"list-button__add",on:{click:t.openModal}},[i("span",[t._v("Create Card")])])])])},b=[],v=o.Ay.extend({name:"ListComponent",components:{LabelEditable:f,Modal:s.A},props:{title:{type:String,required:!0},id:{type:[String,Number],required:!0},cards:{type:Array,required:!0}},data:function(){return{showModal:!1,cardModal:!1,formSchema:{formName:"Add New Card to ".concat(this.title),fields:[{name:"title",label:"Title",type:"text",required:!0,minLength:3},{name:"description",label:"Description",type:"textarea",required:!1,minLength:3},{name:"color",label:"Color",type:"color"},{name:"list_id",label:"List ID",visible:!1,value:this.id},{name:"board_id",label:"Board ID",visible:!1,value:this.$route.params.board_id},{name:"position",label:"Position",visible:!1}],actionName:"createCard",submitUrlPath:"/board/".concat(this.$route.params.board_id,"/card")},formCardSchema:{formName:"Edit Card",fields:[{name:"title",label:"Title",type:"text",required:!0,minLength:3,value:""},{name:"description",label:"Description",type:"textarea",required:!1,minLength:3,value:""},{name:"color",label:"Color",type:"color",required:!0,value:""},{name:"list_id",label:"List ID",visible:!1,value:this.id}],actionName:"editCard",submitUrlPath:"",boardId:this.$route.params.board_id}}},mounted:function(){var t=Number(this.$route.params.card_id);!this.cardModal&&t&&this.cards.some((function(i){return i.id===t}))&&this.editCard(t)},computed:{draggingElementDetails:function(){return this.$store.getters.draggingElementDetails},updatedPosition:{get:function(){return this.$store.state.newPosition}},listTitle:{get:function(){return this.title}}},methods:{handleModalClose:function(){this.cardModal=!1,this.updateRoute(),this.$store.commit("clearEditableCard"),console.log(this.$store.state.editableCard)},updateRoute:function(){this.$router.push("/board/".concat(this.$route.params.board_id))},updateDraggingElement:function(t){this.$store.commit("updateDraggingElementDetails",t)},setDraggingElement:function(t){this.$store.commit("setDraggingElementDetails",t)},getNextPosition:function(){var t,i=this,e=null===(t=this.$store.state.board.lists)||void 0===t?void 0:t.find((function(t){return t.id===i.id}));if(!e||!e.cards||0===e.cards.length)return 0;var n=Math.max.apply(Math,e.cards.map((function(t){return t.position})));return n+1},openModal:function(){var t=this.formSchema.fields.find((function(t){return"position"===t.name}));t&&(t.value=this.getNextPosition()),this.showModal=!0},editCard:function(t){var i,e,n;this.formCardSchema.submitUrlPath="/board/".concat(this.$route.params.board_id,"/card/").concat(t);var r=this.$route.params.board_id,a="/board/".concat(r,"/card/").concat(t);this.$route.path!==a&&this.$router.push(a),console.log("CardID:".concat(t)),console.log(this.$store.state.board),this.$store.commit("setEditableCard",this.findCardById(t)),this.formCardSchema.fields[0].value=null===(i=this.$store.state.editableCard)||void 0===i?void 0:i.title,this.formCardSchema.fields[1].value=null===(e=this.$store.state.editableCard)||void 0===e?void 0:e.description,this.formCardSchema.fields[2].value=null===(n=this.$store.state.editableCard)||void 0===n?void 0:n.color,this.cardModal=!0},removeCard:function(t){this.$store.dispatch("removeCard",{boardId:this.$route.params.board_id,cardId:t})},findCardById:function(t){return this.$store.state.board.lists.map((function(i){var e;return null===(e=i.cards)||void 0===e?void 0:e.find((function(i){return i.id===t}))})).find((function(t){return void 0!==t}))||null},onDragStart:function(t,i){var e=t.target;this.updateDraggingElement({id:Number(i),parentContainer:Number(e.parentElement.id.substring(10)),newContainerId:Number(e.parentElement.id.substring(10)),position:this.findCardById(Number(i)).position}),e&&setTimeout((function(){return e.classList.add("drag__item-clear")}),0)},onDragEnd:function(t){var i,e,n=t.target;if(n){n.classList.remove("hidden","drag__item-clear");var r=this.draggingElementDetails,o=r.id,s=r.parentContainer,d=r.position,l=r.newContainerId,u=r.newPosition;if(null!=d&&null!=u){var c=this.getListWithCardContainerId(s),m=this.getListWithCardContainerId(l);if(c&&m){c.cards=null!==(i=c.cards)&&void 0!==i?i:[],m.cards=null!==(e=m.cards)&&void 0!==e?e:[];var p=c.cards.find((function(t){return t.id===o}));if(p){c.cards=c.cards.filter((function(t){return t.id!==o}));var h=[];if(s===l)c.cards=c.cards.filter((function(t){return t.id!==p.id})).map((function(t){if(u>d){if(t.position>d&&t.position<=u){var i=(0,a.Cl)((0,a.Cl)({},t),{position:t.position-1});return h.push({id:i.id,position:i.position,list_id:s}),i}}else if(u<d&&t.position>=u&&t.position<d){i=(0,a.Cl)((0,a.Cl)({},t),{position:t.position+1});return h.push({id:i.id,position:i.position,list_id:s}),i}return t})),p.position=u,c.cards.splice(u,0,p),h.push({id:p.id,position:u,list_id:s});else{c.cards=c.cards.map((function(t){if(t.position>d){var i=(0,a.Cl)((0,a.Cl)({},t),{position:t.position-1});return h.push({id:i.id,position:i.position,list_id:s}),i}return t}));var f=void 0!==u?u:m.cards.length;m.cards.splice(f,0,(0,a.Cl)((0,a.Cl)({},p),{position:f})),m.cards=m.cards.map((function(t,i){if(t.position!==i){var e=(0,a.Cl)((0,a.Cl)({},t),{position:i});return h.push({id:e.id,position:e.position,list_id:l}),e}return t})),h.push({id:p.id,position:d,list_id:s}),h.push({id:p.id,position:f,list_id:l})}this.$store.dispatch("updateCardsInAPI",{boardId:this.$route.params.board_id,cardsToUpdate:h}),this.setDraggingElement(null)}}}}},onDragEnter:function(t){var i,e=t.currentTarget,n=document.getElementById("card-".concat(this.draggingElementDetails.id));n&&n.parentElement!==e&&(this.updateDraggingElement({newContainerId:Number(e.id.substring(10)),newPosition:e.children.length}),null===(i=n.parentElement)||void 0===i||i.removeChild(n),e.appendChild(n))},onDragOver:function(t){t.preventDefault();var i=t.target;if(i.id){var e=Number(i.id.replace("card-",""));if(this.cards.some((function(t){return t.id===e}))){var n=document.getElementById("card-".concat(this.draggingElementDetails.id));if(n&&n!==i){var r=i.getBoundingClientRect(),a=r.top+r.height/2,o=i.parentNode;if(o){var s=Array.from(o.children),d=s.indexOf(i);t.clientY>a&&(d+=1);var l=s.indexOf(n);if(d!==l){var u=d<s.length?s[d]:null;o.insertBefore(n,u);var c=Array.from(o.children),m=c.indexOf(n);this.setNewPosition(m)}}}}}},getListWithCardContainerId:function(t){var i;return null===(i=this.$store.state.board.lists)||void 0===i?void 0:i.find((function(i){return i.id===t}))},setNewPosition:function(t){this.updateDraggingElement({newPosition:t})}}}),_=v,C=(0,p.A)(_,g,b,!1,null,null,null),y=C.exports,E=o.Ay.extend({name:"BoardView",components:{ListComponent:y,LabelEditable:f,Modal:s.A},data:function(){return{showModal:!1,formSchema:{formName:"Add New List",fields:[{name:"title",label:"Title",type:"text",required:!0,minLength:3},{name:"position",label:"Position",visible:!1},{name:"id",label:"Board ID",visible:!1,value:this.$route.params.board_id}],actionName:"createList",submitUrlPath:"/board/".concat(this.$route.params.board_id,"/list")}}},computed:{board:function(){return this.$store.state.board},boardTitle:{get:function(){return this.$store.state.board.title||""}},labelId:{get:function(){return this.$route.params.board_id||"default-id"}}},mounted:function(){var t,i,e;return(0,a.sH)(this,void 0,void 0,(function(){return(0,a.YH)(this,(function(n){switch(n.label){case 0:return[4,this.$store.dispatch("getBoard",this.$route.params.board_id)];case 1:return n.sent(),this.$data.formSchema.fields[1].value=null!==(e=null===(i=null===(t=this.$store.state.board)||void 0===t?void 0:t.lists)||void 0===i?void 0:i.length)&&void 0!==e?e:0,[2]}}))}))}}),$=E,w=(0,p.A)($,n,r,!1,null,null,null),D=w.exports}}]);
//# sourceMappingURL=916.a14423fd.js.map